<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ election.election_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    {% include '_nav.html' %}
    <h1>{{ election.election_name }}</h1>
    <p>Date: {{ election.election_date }}</p>

    <p>
        <a href="{{ url_for('add_race', election_id=election_id) }}">Add race</a>
    </p>

    <h2>Races</h2>
    <table border="1">
        <thead>
            <tr>
                <th><a href="?sort=race_name&order={{ 'desc' if sort_column == 'race_name' and sort_order == 'asc' else 'asc' }}">Race Name</a></th>
                <th><a href="?sort=seats&order={{ 'desc' if sort_column == 'seats' and sort_order == 'asc' else 'asc' }}">Seats</a></th>
                <th><a href="?sort=total_votes&order={{ 'desc' if sort_column == 'total_votes' and sort_order == 'asc' else 'asc' }}">Total Votes</a></th>
                <th><a href="?sort=term_years&order={{ 'desc' if sort_column == 'term_years' and sort_order == 'asc' else 'asc' }}">Term Years</a></th>
                <th>Winner(s)</th>
                <th>Details</th>
            </tr>
        </thead>
        <tbody>
            {% for race in races %}
            <tr>
                <td>{{ race.race_name }}</td>
                <td>{{ race.seats }}</td>
                <td>{{ race.total_votes }}</td>
                <td>{{ race.term_years }}</td>
                <td>
                    {% for winner in race.winners %}
                        <a href="{{ url_for('individual', contact_id=winner.contact_id) }}">{{ winner.candidate_name }}</a>{% if not loop.last %}, {% endif %}
                    {% endfor %}
                </td>
                <td><a href="{{ url_for('race_details', race_id=race.race_id) }}"><button>Details</button></a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2>Upload races</h2>
    <form method="POST" action="{{ url_for('upload_election_races', election_id=election_id) }}" enctype="multipart/form-data">
        <p>
            <label for="admin_token_upload_races">Admin token:</label><br>
            <input type="password" id="admin_token_upload_races" name="admin_token" required>
        </p>
        <p>
            <label for="races_file">Races file (.csv):</label><br>
            <input type="file" id="races_file" name="races_file" accept=".csv" required>
        </p>
        <p>
            <button type="submit">Upload races</button>
        </p>
    </form>
</body>
</html>